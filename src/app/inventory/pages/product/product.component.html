<div class="row">
  <div class="col-md-2">
    <button
      [ngStyle]="{ borderRadius: '5px' }"
      type="button"
      data-bs-toggle="modal"
      data-bs-target="#producDetails"
      class="btn btn-primary"
      (click)="newFormDoc()"
    >
      Crear producto
    </button>
  </div>
  <div class="col-md-10">
    <input
      [ngStyle]="{ borderRadius: '5px' }"
      #txtSearch
      class="form-control me-sm-2"
      type="text"
      placeholder="Buscar productos"
      (keyup)="onSearch(txtSearch.value)"
    />
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <table
      class="table table-bordered border-primary table-sm table-hover mt-1"
    >
      <thead class="bg-primary text-light">
        <tr>
          <th>Código Barra</th>
          <th class="col-sm-5">Nombre</th>
          <th class="text-end">Precio</th>
          <th>Categoría</th>
          <th>Almacén</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of products | productFilter: page:search">
          <td>{{ product.barcode | uppercase }}</td>
          <td>{{ product.name }}</td>
          <td class="text-end">{{ product.price | currency }}</td>
          <td>{{ product.products_category.name }}</td>
          <td>{{ product.products_store.name }}</td>
          <td class="text-end">
            <a
              [ngStyle]="{ borderRadius: '5px' }"
              data-bs-toggle="modal"
              data-bs-target="#producDetails"
              (click)="onEdit(product)"
              class="btn btn-primary btn-sm"
            >
              Editar
            </a>
            <a
              [ngStyle]="{ borderRadius: '5px' }"
              (click)="onUdateStatus(product)"
              class="btn btn-danger btn-sm mx-1"
            >
              borrar
            </a>
          </td>
        </tr>
      </tbody>
    </table>
    <div>
      <ul class="pagination pagination-sm">
        <button
          [ngStyle]="{ borderRadius: '5px' }"
          type="button"
          class="btn btn-primary btn-sm"
          (click)="prevPage()"
        >
          Anteriores
        </button>

        <button
          [ngStyle]="{ borderRadius: '5px' }"
          type="button"
          class="btn btn-primary btn-sm mx-1"
          (click)="nextPage()"
          [disabled]="(products | productFilter: page:search).length === 0"
        >
          Siguientes
        </button>

        <li
          class="list-group-item d-flex justify-content-between align-items-center mx-1"
        >
          Total de Productos:
          <span class="badge bg-primary rounded-pill mx-1">{{ totalDoc }}</span>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="producDetails"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title" id="exampleModalLabel">Maestro de productos</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="col-md-12">
          <div class="card">
            <div
              [ngStyle]="{ borderRadius: '5px' }"
              class="card-header bg-primary text-light"
            >
              Detalle del producto
            </div>
            <div [ngStyle]="{ borderRadius: '5px' }" class="card-body">
              <form [formGroup]="productForm">
                <input type="hidden" name="id" formControlName="id" />

                <div class="row">
                  <!-- column one  -->
                  <div class="col-md-6">
                    <!-- barcode -->
                    <div class="row">
                      <div class="col-md-3">
                        <label class="form-label">Código</label>
                      </div>

                      <div class="col-md-9">
                        <input
                          [ngStyle]="{ borderRadius: '5px' }"
                          class="form-control form-control-sm"
                          type="text"
                          name="barcode"
                          formControlName="barcode"
                          placeholder="código de barra o personalizado"
                        />
                      </div>
                    </div>

                    <!-- name -->
                    <div class="row mt-2">
                      <div class="col-md-3">
                        <label class="form-label">Nombre</label>
                      </div>

                      <div class="col-md-9">
                        <input
                          [ngStyle]="{ borderRadius: '5px' }"
                          class="form-control form-control-sm"
                          type="text"
                          name="name"
                          formControlName="name"
                          placeholder="nombre del producto"
                        />
                      </div>
                    </div>

                    <!-- cost -->
                    <div class="row mt-2">
                      <div class="col-md-3">
                        <label class="form-label">Costo</label>
                      </div>

                      <div class="col-md-9">
                        <input
                          [ngStyle]="{ borderRadius: '5px' }"
                          class="form-control form-control-sm"
                          type="number"
                          name="cost"
                          formControlName="cost"
                          placeholder="costo del producto"
                        />
                      </div>
                    </div>

                    <!-- price -->
                    <div class="row mt-2">
                      <div class="col-md-3">
                        <label class="form-label">Precio</label>
                      </div>

                      <div class="col-md-9">
                        <input
                          [ngStyle]="{ borderRadius: '5px' }"
                          class="form-control form-control-sm"
                          type="number"
                          name="cost"
                          formControlName="price"
                          placeholder="precio del producto"
                        />
                      </div>
                    </div>
                  </div>

                  <!-- column two  -->
                  <div class="col-md-6">
                    <!-- category -->
                    <div class="row">
                      <div class="col-md-3">
                        <label class="form-label">Categoría</label>
                      </div>
                      <div class="col-md-9">
                        <select
                          [ngStyle]="{ borderRadius: '5px' }"
                          class="form-select"
                          name="idcategory"
                          formControlName="idcategory"
                        >
                          <option
                            [value]="cat.id"
                            *ngFor="let cat of categories"
                          >
                            {{ cat.name }}
                          </option>
                        </select>
                      </div>
                    </div>

                    <!-- store -->
                    <div class="row mt-1">
                      <div class="col-md-3">
                        <label class="form-label">Almacén</label>
                      </div>

                      <div class="col-md-9">
                        <select
                          [ngStyle]="{ borderRadius: '5px' }"
                          class="form-select"
                          name="idstore"
                          formControlName="idstore"
                        >
                          <option
                            [value]="store.id"
                            *ngFor="let store of stores"
                          >
                            {{ store.name }}
                          </option>
                        </select>
                      </div>
                    </div>

                    <!-- tax -->
                    <div class="row mt-1">
                      <div class="col-md-3">
                        <label class="form-label">Impuesto</label>
                      </div>

                      <div class="col-md-9">
                        <select
                          [ngStyle]="{ borderRadius: '5px' }"
                          class="form-select"
                          name="idtax"
                          formControlName="idtax"
                        >
                          <option selected></option>
                          <option *ngFor="let tax of taxs" [value]="tax.id">
                            {{ tax.name }}
                          </option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          [ngStyle]="{ borderRadius: '5px' }"
          type="button"
          id="cancel"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Salir
        </button>
        <ng-container *ngIf="productForm.value.id; else save">
          <button
            [ngStyle]="{ borderRadius: '5px' }"
            type="button"
            class="btn btn-primary"
            (click)="onSave()"
            [disabled]="productForm.invalid"
          >
            Modificar
          </button>
        </ng-container>

        <ng-template #save>
          <button
            [ngStyle]="{ borderRadius: '5px' }"
            type="button"
            class="btn btn-primary"
            (click)="onSave()"
            [disabled]="productForm.invalid"
          >
            Guardar
          </button>
        </ng-template>
      </div>
    </div>
  </div>
</div>
